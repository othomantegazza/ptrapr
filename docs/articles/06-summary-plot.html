<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>06 - Make a Plot that Summarizes Many Panicles • ptrapr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="06 - Make a Plot that Summarizes Many Panicles">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ptrapr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-load-files.html">01 - Load Panicles Files Into R</a>
    </li>
    <li>
      <a href="../articles/02-why-invert-edges.html">02 - Why and How to Invert Edges</a>
    </li>
    <li>
      <a href="../articles/03-dot-plot.html">03 - Visualize The Topology of a Panicle</a>
    </li>
    <li>
      <a href="../articles/04-visualize-many-panicles-loop-r.html">04 - Visualize Many Panicles at Once With a Loop</a>
    </li>
    <li>
      <a href="../articles/05-extract-features.html">05 - Extract and Save Basic Panicle Features</a>
    </li>
    <li>
      <a href="../articles/06-summary-plot.html">06 - Make a Plot that Summarizes Many Panicles</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/othomantegazza/ptrapr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>06 - Make a Plot that Summarizes Many Panicles</h1>
                        <h4 class="author">Otho Mantegazza</h4>
            
            <h4 class="date">2019-03-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/othomantegazza/ptrapr/blob/master/vignettes/06-summary-plot.Rmd"><code>vignettes/06-summary-plot.Rmd</code></a></small>
      <div class="hidden name"><code>06-summary-plot.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Load Packages</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ptrapr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(forcats)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(stringr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</code></pre></div>
</div>
<div id="load-files" class="section level1">
<h1 class="hasAnchor">
<a href="#load-files" class="anchor"></a>load files</h1>
<p>And load files for many panicles as in <a href="04-visualize-many-panicles-loop-r.html">vignette 4</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_to_folder &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="dt">package =</span> <span class="st">"ptrapr"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"/extdata"</span>) </code></pre></div>
<p>(note, when you do this on your files, you have to assign to the variable <code>path_to_folder</code> <strong>the path to your folder</strong>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># path_to_folder &lt;- "path/to/your/folder"</span></code></pre></div>
<p>Read all many panicles in a named list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First record the names of all the files,</span>
panicle_paths &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">list.files</a></span>(path_to_folder) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># remove the extension,</span>
<span class="st">  </span><span class="co"># (each panicle has two files with different extension)</span>
<span class="st">  </span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span>(<span class="st">".ricegr|.ricepr"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># store the name of the files without the extension</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>()

<span class="co"># make a named object</span>
panicle_paths &lt;-
<span class="st">  </span>panicle_paths <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>{<span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">set_names</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(path_to_folder, ., <span class="dt">sep =</span> <span class="st">"/"</span>), <span class="dt">nm =</span> .)}

<span class="co"># read all panicles in a named list</span>
panicle_list &lt;-<span class="st"> </span>
<span class="st">  </span>panicle_paths <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span><span class="kw"><a href="../reference/read_full_panicle.html">read_full_panicle</a></span>(.)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span><span class="kw"><a href="../reference/invert_edges.html">invert_edges</a></span>(., <span class="dt">check_before =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p>Now we have all panicle objects in a named list</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">panicle_list <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(class)</code></pre></div>
<pre><code>## $`1_1_6307`
## [1] "tbl_graph" "igraph"   
## 
## $`1_2_6308`
## [1] "tbl_graph" "igraph"   
## 
## $`1_3_6309`
## [1] "tbl_graph" "igraph"   
## 
## $`2_1_6310`
## [1] "igraph"
## 
## $`2_2_6311`
## [1] "tbl_graph" "igraph"   
## 
## $`2_3_6312`
## [1] "igraph"
## 
## $`3_1_6313`
## [1] "tbl_graph" "igraph"   
## 
## $`3_2_6314`
## [1] "tbl_graph" "igraph"   
## 
## $`3_3_6315`
## [1] "igraph"</code></pre>
</div>
<div id="summarize-features" class="section level1">
<h1 class="hasAnchor">
<a href="#summarize-features" class="anchor"></a>Summarize features</h1>
<p>First you can use the <code><a href="../reference/panicle_tibble.html">panicle_tibble()</a></code> function to turn every panicle graph into a tibble (data frame) that store the features of each node in the panicle.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">panicles_tbs &lt;-<span class="st"> </span>
<span class="st">  </span>panicle_list <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(panicle_tibble)</code></pre></div>
<p>Then you can bind the rows of all the tibbles into one, and summarize the general characteristics of every panicle, grouping every node by its rank along the primary and secondary branch.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summarized_panicles &lt;-<span class="st"> </span>
<span class="st">  </span>panicles_tbs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># bind rows to put all panicles into one tibble</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span>(bind_rows) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 1 node downstream for spikelets</span>
<span class="st">  </span><span class="co"># make more sense when you take average</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">nodes_downstream =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(nodes_downstream <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
                                      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>nodes_downstream)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(primary_rank, secondary_rank) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># how many nodes have that rank? </span>
<span class="st">  </span><span class="co"># one per panicle</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">n =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>(),
            <span class="co"># if that node makes a tertiary branch,</span>
            <span class="co"># how many nodes does the tertiary branch has?</span>
            <span class="dt">nodes_downstream =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(nodes_downstream)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(panicle_list))</code></pre></div>
<p>This is how the summarized dataset looks like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summarized_panicles</code></pre></div>
<pre><code>## # A tibble: 109 x 4
## # Groups:   primary_rank [13]
##    primary_rank secondary_rank     n nodes_downstream
##           &lt;int&gt;          &lt;int&gt; &lt;int&gt;            &lt;dbl&gt;
##  1            1              1     9            2.78 
##  2            1              2     9            1.67 
##  3            1              3     9            1.67 
##  4            1              4     8            0.889
##  5            1              5     8            0.889
##  6            1              6     8            0.889
##  7            1              7     7            0.778
##  8            1              8     6            0.667
##  9            1              9     4            0.444
## 10            2              1     9            3.11 
## # … with 99 more rows</code></pre>
</div>
<div id="plot" class="section level1">
<h1 class="hasAnchor">
<a href="#plot" class="anchor"></a>Plot</h1>
<p>Similar to the panicle tileplot</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summarized_panicles <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> secondary_rank <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(),
             <span class="dt">y =</span> primary_rank <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(),
             <span class="dt">fill =</span> n)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>(<span class="dt">colour =</span> <span class="st">"grey80"</span>,
            <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">label =</span> nodes_downstream <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(<span class="dv">1</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x =</span> <span class="st">"Rank along primary branch"</span>,
       <span class="dt">y =</span> <span class="st">"Rank along the rachis"</span>,
       <span class="dt">fill =</span> <span class="st">"How many panicles</span><span class="ch">\n</span><span class="st">have that node?"</span>,
       <span class="dt">caption =</span> <span class="st">"The numbers indicate the average numbers of nodes into the tertiary branch"</span>)</code></pre></div>
<p><img src="06-summary-plot_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Notes:</p>
<ol style="list-style-type: decimal">
<li>The fill color is the number of panicles that have that node.</li>
<li>The text is the average number of nodes downstream on the secondary branch/spikelet ( 1 = spikelet, &gt; 1 higher order branches)</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#load-files">load files</a></li>
      <li><a href="#summarize-features">Summarize features</a></li>
      <li><a href="#plot">Plot</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Otho Mantegazza.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
